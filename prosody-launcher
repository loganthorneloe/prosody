#!/bin/bash
# GUI launcher for bundled Prosody

LOG_FILE="$HOME/.config/prosody/prosody.log"
mkdir -p "$HOME/.config/prosody"

# Redirect output to log file for debugging
exec >> "$LOG_FILE" 2>&1

# Enable systemd service for auto-start on first run
if [ ! -f "$HOME/.config/prosody/.service-enabled" ]; then
    systemctl --user daemon-reload 2>/dev/null || true
    systemctl --user enable prosody.service 2>/dev/null || true
    touch "$HOME/.config/prosody/.service-enabled"
fi

# Show starting notification
notify-send -i audio-input-microphone "Prosody" "Starting speech-to-text service..." -t 3000 || true

# Run bundled Prosody
exec /opt/prosody/launcher "$@"