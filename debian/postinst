#!/bin/bash
set -e

case "$1" in
    configure)
        # Create system user for prosody if needed (optional)
        # For now, we run as the regular user
        
        # Ensure python3-pip is available
        if ! command -v pip3 &> /dev/null; then
            echo "Installing pip3..."
            apt-get update
            apt-get install -y python3-pip
        fi
        
        # Install Python package in system
        pip3 install --system /usr/share/prosody-stt/ || true
        
        echo ""
        echo "Prosody has been installed!"
        echo ""
        echo "To start Prosody:"
        echo "  - Run: prosody"
        echo "  - Or enable auto-start: systemctl --user enable prosody"
        echo ""
        echo "Usage:"
        echo "  - Double-tap Ctrl to start/stop recording"
        echo "  - Double-tap Escape to cancel recording"
        echo ""
        echo "Note: First run will download the Whisper model (~140MB)"
        ;;
esac

#DEBHELPER#

exit 0